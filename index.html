<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LearnHub - Online Learning Platform</title>

  <!-- Google Tag Manager (head) -->
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-56V436M4');
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KN0JLE9TWG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KN0JLE9TWG');
  </script>

  <!-- Microsoft Clarity (DIRECT INSTALL).
       If you install Clarity via GTM instead, remove this block to avoid double loading. -->
  <script>
  (function(c,l,a,r,i,t,y){ 
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r); t.async=1; t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "sy6aqstjtk"); /* ‚Üê REPLACE */
  </script>

  <style>
    :root{
      --green:#4CAF50;
      --green-dark:#45a049;
      --muted:#f5f5f5;
      --card-shadow: 0 8px 20px rgba(0,0,0,0.08);
      --radius:12px;
      --maxwidth:1200px;
      --accent:#2196F3;
      --red:#f44336;
      --purple:#9C27B0;
    }
    *{box-sizing:border-box}
    body{font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin:0; background:var(--muted); color:#222}
    .hidden{display:none !important}
    .fade-in{animation:fadeIn 0.3s ease-in}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .navbar{background:linear-gradient(90deg,var(--green),var(--green-dark)); box-shadow:0 3px 8px rgba(0,0,0,0.08);}
    .nav-inner{max-width:var(--maxwidth); margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:10px 20px;}
    .brand{color:#fff; font-weight:700; font-size:26px; cursor:pointer}
    .nav-links{display:flex; gap:10px; align-items:center}
    .nav-links a{color:rgba(255,255,255,0.95); text-decoration:none; padding:10px 14px; border-radius:6px; font-weight:600; cursor:pointer}
    .nav-links a.active, .nav-links a:hover{background:rgba(255,255,255,0.08)}
    .auth{display:flex; gap:8px; align-items:center}
    .btn{padding:8px 14px; border-radius:8px; text-decoration:none; cursor:pointer; font-weight:600; border:none}
    .btn-outline{background:transparent; color:#fff; border:2px solid rgba(255,255,255,0.2)}
    .btn-primary{background:#fff; color:var(--green)}
    .btn-success{background:var(--green); color:#fff}
    .btn-danger{background:var(--red); color:#fff}
    .hero{background:#fff; padding:60px 20px 40px; text-align:center; box-shadow:0 4px 14px rgba(0,0,0,0.04); margin-bottom:24px}
    .hero h1{font-size:42px; margin:0 0 8px; color:#222}
    .hero p{color:#666; margin:0; font-size:18px}
    .container{max-width:var(--maxwidth); margin:28px auto; padding:0 20px}
    .courses-grid{display:grid; grid-template-columns: repeat(3,1fr); gap:28px}
    @media (max-width:1000px){ .courses-grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:640px){ .courses-grid{grid-template-columns:1fr} .nav-links{display:none} }
    .card{background:#fff; border-radius:var(--radius); overflow:hidden; box-shadow:var(--card-shadow); display:flex; flex-direction:column; cursor:pointer; transition:transform 0.2s}
    .card:hover{transform:translateY(-2px)}
    .card-media{height:150px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:36px}
    .card-body{padding:18px; flex:1; display:flex; flex-direction:column}
    .card-title{font-size:18px; font-weight:700; margin-bottom:6px; color:#222}
    .card-meta{color:#888; font-size:13px; margin-bottom:12px}
    .card-stats{display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; color:#666}
    .price{font-weight:700; color:var(--green)}
    .price.free{color:var(--accent)}
    .card-footer{display:flex; justify-content:space-between; align-items:center; padding:0 18px 18px}
    .enroll{background:var(--green); color:#fff; padding:8px 14px; border-radius:8px; cursor:pointer; border:none; font-weight:700}
    .apply{background:#2e8b57; color:#fff; padding:8px 14px; border-radius:8px; border:none; cursor:pointer}
    .private{background:var(--purple)}
    .stars{color:#ffc107; margin-right:6px; font-weight:700}
    .small{font-size:13px;color:#666}
    .modal{position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:1000}
    .modal-content{background:#fff; border-radius:var(--radius); max-width:500px; width:90%; max-height:90vh; overflow-y:auto}
    .modal-header{padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center}
    .modal-title{font-size:22px; font-weight:700; margin:0}
    .modal-close{background:none; border:none; font-size:24px; cursor:pointer; color:#666}
    .modal-body{padding:20px}
    .modal-footer{padding:20px; border-top:1px solid #eee; display:flex; justify-content:flex-end; gap:10px}
    .form-group{margin-bottom:20px}
    .form-label{display:block; margin-bottom:6px; font-weight:600; color:#333}
    .form-control{width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:14px}
    .form-control:focus{border-color:var(--green); outline:none}
    .form-text{font-size:12px; color:#666; margin-top:4px}
    .course-detail{background:#fff; border-radius:var(--radius); box-shadow:var(--card-shadow); margin-bottom:20px}
    .course-hero{padding:30px; text-align:center; background:linear-gradient(135deg,var(--green),var(--green-dark)); color:#fff}
    .course-hero h1{font-size:32px; margin:0 0 10px}
    .course-hero p{font-size:16px; opacity:0.9; margin:0}
    .course-content{padding:30px}
    .course-meta{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px}
    .meta-item{text-align:center; padding:15px; background:var(--muted); border-radius:8px}
    .meta-label{font-size:12px; color:#666; text-transform:uppercase; margin-bottom:5px}
    .meta-value{font-size:18px; font-weight:700; color:#333}
    .course-description{line-height:1.6; color:#555}
    .course-curriculum{margin:30px 0}
    .curriculum-item{padding:15px; border:1px solid #eee; border-radius:8px; margin-bottom:10px}
    .curriculum-title{font-weight:600; color:#333}
    .curriculum-duration{font-size:12px; color:#666}
    .checkout-summary{background:#fff; border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; margin-bottom:20px}
    .summary-item{display:flex; justify-content:space-between; margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid #eee}
    .summary-total{font-size:18px; font-weight:700; color:var(--green)}
    .dashboard-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px}
    .stat-card{background:#fff; border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; text-align:center}
    .stat-number{font-size:32px; font-weight:700; color:var(--green); margin-bottom:5px}
    .stat-label{color:#666; text-transform:uppercase; font-size:12px}
    .progress-bar{width:100%; height:8px; background:#eee; border-radius:4px; overflow:hidden; margin:10px 0}
    .progress-fill{height:100%; background:var(--green); transition:width 0.3s}
    .breadcrumb{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:#666; font-size:14px}
    .breadcrumb a{color:var(--accent); text-decoration:none}
    .breadcrumb span{margin:0 5px}
    .alert{padding:15px 20px; border-radius:8px; margin-bottom:20px}
    .alert-success{background:#d4edda; color:#155724; border:1px solid #c3e6cb}
    .alert-info{background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb}
    .alert-warning{background:#fff3cd; color:#856404; border:1px solid #ffeaa7}
  </style>
</head>
<body>

  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-56V436M4"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-inner">
      <div class="brand" onclick="showPage('home')">LearnHub</div>
      <nav class="nav-links" aria-label="Main navigation">
        <a onclick="showPage('home')" data-page="home">HOME</a>
        <a onclick="showPage('courses')" data-page="courses">COURSES</a>
        <a onclick="showPage('blog')" data-page="blog">BLOG</a>
        <a onclick="showPage('business')" data-page="business">BUSINESS</a>
        <a onclick="showPage('contact')" data-page="contact">CONTACT</a>
      </nav>
      <div class="auth">
        <a class="btn btn-outline" onclick="openLogin()" id="loginBtn">Login</a>
        <a class="btn btn-primary" onclick="openSignup()" id="signupBtn">Sign Up</a>
        <a class="btn btn-success hidden" onclick="showPage('dashboard')" id="dashboardBtn">Dashboard</a>
        <a class="btn btn-danger hidden" onclick="logout()" id="logoutBtn">Logout</a>
      </div>
    </div>
  </header>

  <!-- HOME PAGE -->
  <div id="homePage" class="page">
    <section class="hero">
      <h1>Welcome to LearnHub</h1>
      <p>Discover amazing courses and expand your knowledge</p>
    </section>

    <main class="container">
      <h2 style="margin:6px 0 18px; font-size:26px; color:#222">Available Courses</h2>
      <div class="courses-grid" id="coursesGrid"></div>
    </main>
  </div>

  <!-- COURSES PAGE -->
  <div id="coursesPage" class="page hidden">
    <section class="hero">
      <h1>All Courses</h1>
      <p>Browse our complete catalog of courses</p>
    </section>
    <main class="container">
      <div class="courses-grid" id="allCoursesGrid"></div>
    </main>
  </div>

  <!-- COURSE DETAIL PAGE -->
  <div id="courseDetailPage" class="page hidden">
    <main class="container">
      <nav class="breadcrumb">
        <a onclick="showPage('home')">Home</a> <span>></span> 
        <a onclick="showPage('courses')">Courses</a> <span>></span>
        <span id="courseDetailBreadcrumb">Course Details</span>
      </nav>
      
      <div class="course-detail">
        <div class="course-hero" id="courseDetailHero">
          <h1 id="courseDetailTitle">Course Title</h1>
          <p id="courseDetailInstructor">By Instructor</p>
        </div>
        
        <div class="course-content">
          <div class="course-meta">
            <div class="meta-item">
              <div class="meta-label">Rating</div>
              <div class="meta-value" id="courseDetailRating">4.5 ‚≠ê</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Students</div>
              <div class="meta-value" id="courseDetailStudents">0</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Duration</div>
              <div class="meta-value" id="courseDetailDuration">4 weeks</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Price</div>
              <div class="meta-value" id="courseDetailPrice">Rs0</div>
            </div>
          </div>
          
          <div class="course-description">
            <h3>About This Course</h3>
            <p id="courseDetailDescription">This comprehensive course will teach you everything you need to know...</p>
          </div>
          
          <div class="course-curriculum">
            <h3>Curriculum</h3>
            <div id="curriculumList"></div>
          </div>
          
          <div style="text-align:center; margin-top:30px">
            <button class="btn btn-success" style="padding:15px 30px; font-size:18px" onclick="proceedToCheckout()" id="enrollMainBtn">
              Enroll Now
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- CHECKOUT PAGE -->
  <div id="checkoutPage" class="page hidden">
    <main class="container">
      <nav class="breadcrumb">
        <a onclick="showPage('home')">Home</a> <span>></span>
        <a onclick="showPage('courses')">Courses</a> <span>></span>
        <span>Checkout</span>
      </nav>
      
      <h2>Checkout</h2>
      
      <div style="display:grid; grid-template-columns:1fr 400px; gap:30px">
        <div>
          <div class="checkout-summary">
            <h3>Payment Information</h3>
            <form id="checkoutForm">
              <div class="form-group">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" id="checkoutEmail" required>
              </div>
              <div class="form-group">
                <label class="form-label">Card Number</label>
                <input type="text" class="form-control" placeholder="1234 5678 9012 3456" required>
              </div>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px">
                <div class="form-group">
                  <label class="form-label">Expiry Date</label>
                  <input type="text" class="form-control" placeholder="MM/YY" required>
                </div>
                <div class="form-group">
                  <label class="form-label">CVC</label>
                  <input type="text" class="form-control" placeholder="123" required>
                </div>
              </div>
            </form>
          </div>
        </div>
        
        <div class="checkout-summary">
          <h3>Order Summary</h3>
          <div class="summary-item">
            <span id="checkoutCourseName">Course Name</span>
            <span id="checkoutCoursePrice">¬£0</span>
          </div>
          <div class="summary-item">
            <span>VAT (20%)</span>
            <span id="checkoutVAT">¬£0</span>
          </div>
          <div class="summary-item summary-total">
            <span>Total</span>
            <span id="checkoutTotal">¬£0</span>
          </div>
          <button class="btn btn-success" style="width:100%; margin-top:20px; padding:15px" onclick="completePayment()">
            Complete Payment
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- SUCCESS PAGE -->
  <div id="successPage" class="page hidden">
    <main class="container">
      <div style="text-align:center; padding:60px 20px">
        <div style="font-size:64px; color:var(--green); margin-bottom:20px">‚úÖ</div>
        <h1 style="color:var(--green); margin-bottom:20px">Enrollment Successful!</h1>
        <p style="font-size:18px; color:#666; margin-bottom:30px">
          Welcome to <span id="successCourseName">your course</span>! You can now access all course materials.
        </p>
        <div style="display:flex; gap:15px; justify-content:center">
          <button class="btn btn-success" onclick="showPage('dashboard')">Go to Dashboard</button>
          <button class="btn btn-outline" style="color:var(--green); border-color:var(--green)" onclick="showPage('courses')">Browse More Courses</button>
        </div>
      </div>
    </main>
  </div>

  <!-- DASHBOARD PAGE -->
  <div id="dashboardPage" class="page hidden">
    <main class="container">
      <h2>My Learning Dashboard</h2>
      
      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-number" id="enrolledCoursesCount">0</div>
          <div class="stat-label">Enrolled Courses</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="completedCoursesCount">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalHoursCount">0</div>
          <div class="stat-label">Hours Studied</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="averageRating">4.8</div>
          <div class="stat-label">Average Rating</div>
        </div>
      </div>

      <h3>My Courses</h3>
      <div id="myCoursesList"></div>
    </main>
  </div>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Login</h3>
        <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="loginEmail" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" id="loginPassword" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('loginModal')">Cancel</button>
        <button class="btn btn-success" onclick="performLogin()">Login</button>
      </div>
    </div>
  </div>

  <!-- SIGNUP MODAL -->
  <div id="signupModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Sign Up</h3>
        <button class="modal-close" onclick="closeModal('signupModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="signupForm">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control" id="signupName" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="signupEmail" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" id="signupPassword" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('signupModal')">Cancel</button>
        <button class="btn btn-success" onclick="performSignup()">Sign Up</button>
      </div>
    </div>
  </div>

  <script>
    /* -------------------- ANALYTICS HELPERS -------------------- */
    // GA + dataLayer (already in your code)
    window.dataLayer = window.dataLayer || [];
    function pushEventToDataLayer(eventName, payload) {
      const obj = Object.assign({ event: eventName }, payload || {});
      window.dataLayer.push(obj);
      if (typeof gtag === 'function') {
        try { gtag('event', eventName, payload || {}); } catch(e) {}
      }
      // Send to Clarity too:
      cSet(payload || {});          // attach relevant tags (if any)
      cEvent(eventName);           // log the event
      // console:
      console.log('Analytics ‚Üí', obj);
    }

    // Clarity helpers (safe wrappers)
    function cReady(){ return typeof clarity === 'function'; }
    function cEvent(name){ if(cReady()) try{ clarity('event', String(name)); }catch(e){} }
    function cSet(obj){
      if(!cReady() || !obj) return;
      try{
        Object.keys(obj).forEach(k=>{
          const v = obj[k];
          // Avoid huge objects/arrays; store primitives only as tags
          if (['string','number','boolean'].includes(typeof v)) {
            clarity('set', k, v);
          }
        });
      }catch(e){}
    }
    function cIdentify(id){
      if(cReady() && id!=null) try{ clarity('identify', String(id)); }catch(e){}
    }

    /* -------------------- APP STATE -------------------- */
    let currentUser = null;
    let enrolledCourses = [];
    let currentCourse = null;

    const courses = [
      {
        id: 1,
        name: "How to write effectively",
        instructor: "CHARLIE",
        price: "FREE",
        rating: 4.0,
        students: 125,
        duration: "2 weeks",
        description: "Master the art of effective writing with practical exercises and expert feedback. Learn to communicate clearly and persuasively in any context.",
        emoji: "üíª",
        gradient: "linear-gradient(135deg,#20B2AA,#008B8B)",
        curriculum: [
          { title: "Introduction to Effective Writing", duration: "30 mins" },
          { title: "Grammar and Style Fundamentals", duration: "45 mins" },
          { title: "Structuring Your Content", duration: "40 mins" },
          { title: "Writing for Different Audiences", duration: "35 mins" }
        ]
      },
      {
        id: 2,
        name: "Digital Photography",
        instructor: "CHARLIE",
        price: "Rs15.00 per 3 weeks",
        priceNum: 15,
        rating: 5.0,
        students: 89,
        duration: "3 weeks",
        description: "Capture stunning photos with your digital camera. Learn composition, lighting, and post-processing techniques from professional photographers.",
        emoji: "üì∏",
        gradient: "linear-gradient(135deg,#FFB000,#FF8C00)",
        curriculum: [
          { title: "Camera Settings and Controls", duration: "25 mins" },
          { title: "Composition Techniques", duration: "35 mins" },
          { title: "Lighting and Exposure", duration: "40 mins" },
          { title: "Post-Processing Basics", duration: "50 mins" }
        ]
      },
      {
        id: 3,
        name: "Software Training",
        instructor: "CHARLIE",
        price: "Rs25.00 per week",
        priceNum: 25,
        rating: 4.2,
        students: 156,
        duration: "4 weeks",
        description: "Comprehensive software training covering industry-standard applications. Perfect for beginners and professionals looking to upgrade their skills.",
        emoji: "üñ•Ô∏è",
        gradient: "linear-gradient(135deg,#DEB887,#CD853F)",
        curriculum: [
          { title: "Software Basics and Interface", duration: "30 mins" },
          { title: "Essential Tools and Features", duration: "45 mins" },
          { title: "Advanced Techniques", duration: "60 mins" },
          { title: "Project-Based Learning", duration: "90 mins" }
        ]
      },
      {
        id: 4,
        name: "Social Media Management",
        instructor: "CHARLIE",
        price: "Rs27.00 per 2 months",
        priceNum: 27,
        rating: 4.1,
        students: 203,
        duration: "8 weeks",
        description: "Build and manage successful social media campaigns. Learn content creation, audience engagement, and analytics across all major platforms.",
        emoji: "üì±",
        gradient: "linear-gradient(135deg,#9ACD32,#7CB342)",
        curriculum: [
          { title: "Social Media Strategy", duration: "40 mins" },
          { title: "Content Creation", duration: "55 mins" },
          { title: "Community Management", duration: "35 mins" },
          { title: "Analytics and Optimization", duration: "45 mins" }
        ]
      },
      {
        id: 5,
        name: "Basics of Nature Photography",
        instructor: "CHARLIE",
        price: "Rs18.00 per 30 days",
        priceNum: 18,
        rating: 4.9,
        students: 178,
        duration: "4 weeks",
        description: "Discover the beauty of nature through your lens. Learn landscape, wildlife, and macro photography techniques in natural settings.",
        emoji: "üì∑",
        gradient: "linear-gradient(135deg,#FF9800,#F57C00)",
        curriculum: [
          { title: "Nature Photography Fundamentals", duration: "30 mins" },
          { title: "Landscape Photography", duration: "45 mins" },
          { title: "Wildlife Photography", duration: "40 mins" },
          { title: "Macro and Close-up Photography", duration: "35 mins" }
        ]
      }
    ];

    /* -------------------- NAVIGATION -------------------- */
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
      const targetPage = document.getElementById(pageId + 'Page');
      if (targetPage) {
        targetPage.classList.remove('hidden');
        targetPage.classList.add('fade-in');
      }
      document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active'));
      const activeLink = document.querySelector(`[data-page="${pageId}"]`);
      if (activeLink) activeLink.classList.add('active');

      // GA + Clarity page view
      pushEventToDataLayer('page_view', {
        page_name: pageId,
        page_location: window.location.href + '#' + pageId
      });
      cSet({ page_name: pageId }); // tag the page in Clarity

      if (pageId === 'home' || pageId === 'courses') {
        loadCourses(pageId === 'courses');
      }
    }

    /* -------------------- COURSES RENDER -------------------- */
    function loadCourses(showAll = false) {
      const grid = showAll ? document.getElementById('allCoursesGrid') : document.getElementById('coursesGrid');
      const coursesToShow = showAll ? courses : courses.slice(0, 3);
      grid.innerHTML = coursesToShow.map(course => `
        <article class="card" data-course-id="${course.id}" data-course-name="${course.name}" data-course-price="${course.price}">
          <div class="card-media" style="background:${course.gradient};">${course.emoji}</div>
          <div class="card-body">
            <div class="card-title">${course.name}</div>
            <div class="card-meta">${course.instructor}</div>
            <div class="card-stats">
              <div><span class="stars">${'‚òÖ'.repeat(Math.floor(course.rating))}${'‚òÜ'.repeat(5-Math.floor(course.rating))}</span><span class="small">${course.rating}</span></div>
              <div class="small">${course.students} students</div>
            </div>
          </div>
          <div class="card-footer">
            <div class="price ${course.price === 'FREE' ? 'free' : ''}">${course.price}</div>
            <button class="enroll" data-action="enroll" data-course-id="${course.id}">
              ${course.price === 'FREE' ? 'Enroll Now' : 'View Course'}
            </button>
          </div>
        </article>
      `).join('');
      attachCourseEventListeners();
    }

    function attachCourseEventListeners() {
      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', function(e) {
          if (e.target.closest('button')) return;
          const courseId = parseInt(card.dataset.courseId);
          const courseName = card.dataset.courseName;
          const coursePrice = card.dataset.coursePrice;

          pushEventToDataLayer('course_selected', {
            course_id: courseId,
            course_name: courseName,
            course_price: coursePrice
          });
          cSet({ course_id: courseId, course_name: courseName, course_price: coursePrice });

          showCourseDetail(courseId);
        });
      });

      document.querySelectorAll('[data-action="enroll"]').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const courseId = parseInt(btn.dataset.courseId);
          const course = courses.find(c => c.id === courseId);

          pushEventToDataLayer('course_enroll_attempt', {
            course_id: courseId,
            course_name: course.name,
            course_price: course.price,
            method: course.price === 'FREE' ? 'quick_enroll' : 'detail_then_checkout'
          });

          if (course.price === 'FREE') {
            if (currentUser) {
              enrollInCourse(courseId);
            } else {
              openLogin();
            }
          } else {
            showCourseDetail(courseId);
          }
        });
      });
    }

    /* -------------------- COURSE DETAIL -------------------- */
    function showCourseDetail(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (!course) return;

      currentCourse = course;

      document.getElementById('courseDetailBreadcrumb').textContent = course.name;
      const hero = document.getElementById('courseDetailHero');
      hero.style.background = course.gradient;
      document.getElementById('courseDetailTitle').textContent = course.name;
      document.getElementById('courseDetailInstructor').textContent = `By ${course.instructor}`;
      document.getElementById('courseDetailRating').textContent = `${course.rating} ‚≠ê`;
      document.getElementById('courseDetailStudents').textContent = course.students;
      document.getElementById('courseDetailDuration').textContent = course.duration;
      document.getElementById('courseDetailPrice').textContent = course.price;
      document.getElementById('courseDetailDescription').textContent = course.description;

      const curriculumList = document.getElementById('curriculumList');
      curriculumList.innerHTML = course.curriculum.map(item => `
        <div class="curriculum-item">
          <div class="curriculum-title">${item.title}</div>
          <div class="curriculum-duration">${item.duration}</div>
        </div>
      `).join('');

      const enrollBtn = document.getElementById('enrollMainBtn');
      if (course.price === 'FREE') {
        enrollBtn.textContent = 'Enroll Now';
        enrollBtn.onclick = () => {
          if (currentUser) enrollInCourse(courseId);
          else openLogin();
        };
      } else {
        enrollBtn.textContent = 'Proceed to Checkout';
        enrollBtn.onclick = () => proceedToCheckout();
      }

      showPage('courseDetail');

      // Track course view
      pushEventToDataLayer('course_view', {
        course_id: courseId,
        course_name: course.name,
        course_price: course.price
      });
      cSet({ course_id: courseId, course_name: course.name, course_price: course.price });
    }

    /* -------------------- CHECKOUT -------------------- */
    function proceedToCheckout() {
      if (!currentCourse) return;
      if (!currentUser) { openLogin(); return; }
      if (currentCourse.price === 'FREE') { enrollInCourse(currentCourse.id); return; }

      document.getElementById('checkoutCourseName').textContent = currentCourse.name;
      document.getElementById('checkoutCoursePrice').textContent = currentCourse.price;

      const price = currentCourse.priceNum || 0;
      const vat = Math.round(price * 0.2 * 100) / 100;
      const total = Math.round((price + vat) * 100) / 100;

      document.getElementById('checkoutVAT').textContent = `¬£${vat.toFixed(2)}`;
      document.getElementById('checkoutTotal').textContent = `¬£${total.toFixed(2)}`;

      if (currentUser) {
        document.getElementById('checkoutEmail').value = currentUser.email;
      }

      showPage('checkout');

      pushEventToDataLayer('begin_checkout', {
        course_id: currentCourse.id,
        course_name: currentCourse.name,
        value: total,
        currency: 'GBP'
      });
      cSet({ course_id: currentCourse.id, course_name: currentCourse.name, checkout_value: total, currency: 'GBP' });
    }

    function completePayment() {
      if (!currentCourse) return;
      const form = document.getElementById('checkoutForm');
      if (!form.checkValidity()) { form.reportValidity(); return; }

      const price = currentCourse.priceNum || 0;
      const total = Math.round(price * 1.2 * 100) / 100;

      pushEventToDataLayer('purchase_attempt', {
        course_id: currentCourse.id,
        course_name: currentCourse.name,
        value: total,
        currency: 'GBP'
      });

      setTimeout(() => {
        pushEventToDataLayer('purchase', {
          transaction_id: 'txn_' + Date.now(),
          course_id: currentCourse.id,
          course_name: currentCourse.name,
          value: total,
          currency: 'GBP'
        });
        cSet({ transaction_id: 'txn_' + Date.now(), value: total, currency: 'GBP' });

        enrollInCourse(currentCourse.id);
        document.getElementById('successCourseName').textContent = currentCourse.name;
        showPage('success');
      }, 800);
    }

    /* -------------------- ENROLLMENT -------------------- */
    function enrollInCourse(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (!course || !currentUser) return;

      if (!enrolledCourses.find(c => c.id === courseId)) {
        enrolledCourses.push({
          ...course,
          enrolledAt: new Date(),
          progress: 0,
          completed: false
        });

        pushEventToDataLayer('course_enrolled', {
          course_id: courseId,
          course_name: course.name,
          course_price: course.price,
          enrollment_method: course.price === 'FREE' ? 'free' : 'paid'
        });
        cSet({ course_id: courseId, enrollment_method: (course.price === 'FREE' ? 'free' : 'paid') });

        updateDashboardStats();

        if (course.price === 'FREE') {
          document.getElementById('successCourseName').textContent = course.name;
          showPage('success');
        }
      }
    }

    /* -------------------- AUTH -------------------- */
    function openLogin() {
      document.getElementById('loginModal').classList.remove('hidden');
      pushEventToDataLayer('login_modal_opened', { trigger: 'enrollment_required' });
    }
    function openSignup() {
      document.getElementById('signupModal').classList.remove('hidden');
      pushEventToDataLayer('signup_modal_opened', {});
    }
    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
      pushEventToDataLayer('modal_closed', { modal_id: modalId });
    }

    function performLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) return;

      currentUser = { id: 1, email, name: email.split('@')[0], joinedAt: new Date() };
      updateAuthUI();
      closeModal('loginModal');

      pushEventToDataLayer('login', { method: 'email', user_id: currentUser.id });
      cIdentify(currentUser.id);    // Clarity user id
      cSet({ signed_in: true });    // tag session

      if (currentCourse) {
        if (currentCourse.price === 'FREE') enrollInCourse(currentCourse.id);
        else proceedToCheckout();
      }
    }

    function performSignup() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      if (!name || !email || !password) return;

      currentUser = { id: Date.now(), email, name, joinedAt: new Date() };
      updateAuthUI();
      closeModal('signupModal');

      pushEventToDataLayer('sign_up', { method: 'email', user_id: currentUser.id });
      cIdentify(currentUser.id);
      cSet({ signed_in: true });

      if (currentCourse) {
        if (currentCourse.price === 'FREE') enrollInCourse(currentCourse.id);
        else proceedToCheckout();
      }
    }

    function logout() {
      currentUser = null;
      enrolledCourses = [];
      updateAuthUI();
      showPage('home');
      pushEventToDataLayer('logout', {});
      cSet({ signed_in: false });
    }

    function updateAuthUI() {
      const loginBtn = document.getElementById('loginBtn');
      const signupBtn = document.getElementById('signupBtn');
      const dashboardBtn = document.getElementById('dashboardBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      if (currentUser) {
        loginBtn.classList.add('hidden');
        signupBtn.classList.add('hidden');
        dashboardBtn.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
      } else {
        loginBtn.classList.remove('hidden');
        signupBtn.classList.remove('hidden');
        dashboardBtn.classList.add('hidden');
        logoutBtn.classList.add('hidden');
      }
    }

    /* -------------------- DASHBOARD -------------------- */
    function updateDashboardStats() {
      document.getElementById('enrolledCoursesCount').textContent = enrolledCourses.length;
      document.getElementById('completedCoursesCount').textContent = enrolledCourses.filter(c => c.completed).length;
      document.getElementById('totalHoursCount').textContent = enrolledCourses.length * 4;

      const coursesList = document.getElementById('myCoursesList');
      if (enrolledCourses.length === 0) {
        coursesList.innerHTML = '<p>No courses enrolled yet. <a onclick="showPage(\'courses\')">Browse courses</a> to get started!</p>';
      } else {
        coursesList.innerHTML = enrolledCourses.map(course => `
          <div class="course-detail" style="margin-bottom:20px">
            <div style="padding:20px; display:flex; justify-content:space-between; align-items:center">
              <div>
                <h3>${course.name}</h3>
                <p style="color:#666; margin:5px 0">by ${course.instructor}</p>
                <div class="progress-bar"><div class="progress-fill" style="width:${course.progress}%"></div></div>
                <small style="color:#666">${course.progress}% completed</small>
              </div>
              <button class="btn btn-success" onclick="startLearning(${course.id})">
                ${course.progress > 0 ? 'Continue' : 'Start'} Learning
              </button>
            </div>
          </div>
        `).join('');
      }
    }

    function startLearning(courseId) {
      const course = enrolledCourses.find(c => c.id === courseId);
      if (!course) return;

      pushEventToDataLayer('course_learning_started', { course_id: courseId, course_name: course.name });
      cSet({ course_id: courseId, course_name: course.name });

      course.progress = Math.min(100, course.progress + 25);
      if (course.progress === 100) {
        course.completed = true;
        pushEventToDataLayer('course_completed', { course_id: courseId, course_name: course.name });
      }
      updateDashboardStats();
    }

    /* -------------------- INIT & EXTRA PAGES -------------------- */
    document.addEventListener('DOMContentLoaded', function() {
      showPage('home'); // initial view

      pushEventToDataLayer('page_view_custom', {
        page_title: document.title,
        page_location: window.location.href
      });

      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) closeModal(modal.id);
        });
      });
    });

    // Simple extra pages (Blog / Business / Contact)
    document.addEventListener('DOMContentLoaded', function() {
      const additionalPages = [
        {
          id: 'blog',
          title: 'Blog & Press',
          content: `
            <section class="hero">
              <h1>Blog & Press</h1>
              <p>Latest news, insights, and learning tips</p>
            </section>
            <main class="container">
              <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px">
                <article class="card" onclick="trackBlogClick('learning-tips')">
                  <div style="padding:20px">
                    <h3>10 Tips for Effective Online Learning</h3>
                    <p style="color:#666">Master the art of learning from home with these proven strategies...</p>
                    <small style="color:#999">Published 2 days ago</small>
                  </div>
                </article>
                <article class="card" onclick="trackBlogClick('photography-guide')">
                  <div style="padding:20px">
                    <h3>Photography Guide for Beginners</h3>
                    <p style="color:#666">Everything you need to know to start your photography journey...</p>
                    <small style="color:#999">Published 5 days ago</small>
                  </div>
                </article>
              </div>
            </main>
          `
        },
        {
          id: 'business',
          title: 'Business Solutions',
          content: `
            <section class="hero">
              <h1>Business Solutions</h1>
              <p>Corporate training and team development</p>
            </section>
            <main class="container">
              <div style="text-align:center; padding:40px 0">
                <h2>Transform Your Team with LearnHub Business</h2>
                <p style="font-size:18px; color:#666; margin-bottom:30px">Upskill your workforce with our comprehensive corporate training programs</p>
                <button class="btn btn-success" onclick="trackBusinessInquiry()" style="padding:15px 30px; font-size:18px">
                  Request Demo
                </button>
              </div>
            </main>
          `
        },
        {
          id: 'contact',
          title: 'Contact Us',
          content: `
            <section class="hero">
              <h1>Contact Us</h1>
              <p>Get in touch with our team</p>
            </section>
            <main class="container">
              <div style="max-width:600px; margin:0 auto">
                <form id="contactForm" onsubmit="submitContactForm(event)">
                  <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select class="form-control" id="contactSubject" required>
                      <option value="">Select a topic</option>
                      <option value="course-inquiry">Course Inquiry</option>
                      <option value="technical-support">Technical Support</option>
                      <option value="business-partnership">Business Partnership</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-control" rows="5" required></textarea>
                  </div>
                  <button type="submit" class="btn btn-success">Send Message</button>
                </form>
              </div>
            </main>
          `
        }
      ];

      additionalPages.forEach(page => {
        const pageDiv = document.createElement('div');
        pageDiv.id = page.id + 'Page';
        pageDiv.className = 'page hidden';
        pageDiv.innerHTML = page.content;
        document.body.appendChild(pageDiv);
      });
    });

    // Extra tracking
    function trackBlogClick(articleId) {
      pushEventToDataLayer('blog_article_click', { article_id: articleId });
    }
    function trackBusinessInquiry() {
      pushEventToDataLayer('business_demo_request', { source: 'business_page' });
      alert('Thank you for your interest! Our team will contact you within 24 hours.');
    }
    function submitContactForm(event) {
      event.preventDefault();
      const subject = document.getElementById('contactSubject').value;
      pushEventToDataLayer('contact_form_submit', { subject: subject });
      alert('Thank you for your message! We\'ll get back to you soon.');
      event.target.reset();
    }
  </script>
</body>
</html>

